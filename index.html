<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Incident Report Feed</title>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;700;900&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<link rel="stylesheet" href="./styles.css">
<script type="module" src="./firebase-config.js"></script>
</head>
<body class="bg-background-dark">
<div class="container">
<header class="header">
<div class="flex items-center justify-between p-4">
<div class="flex items-center gap-2">
<span class="material-symbols-outlined text-zinc-900">location_on</span>
<h1 class="text-xl font-bold text-zinc-900">San Francisco</h1>
</div>
<button class="p-2 rounded-full hover-primary">
<span class="material-symbols-outlined text-zinc-900">notifications</span>
</button>
</div>
<div class="px-4 pb-4">
<div class="flex items-center gap-4">
<img alt="Anonymous user avatar" class="w-14 h-14 rounded-full" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCy998_EKxMaodnFCM8aGsWCxqi8SsKu6gsG48ne88fWm1bNMk43V28HtDYo8t0PkB7AMs8roscESwJag_Y96UrEbBN8iU3IVziBjwXm511zu_DJslJhAR4dtoxsKCqAHW60ahzRZK1BR16xclouoPwcZjPJAy3F81zFP3_Il4cofZXoFBcvE-PqZPD9VDMtqI_P0HhLCRIndc_tiS8KtucDgU4TUCBZI1nXrx1atpwM6cMwFsjoCadNmbqv_CMUDVDvo_F6BjKohwJ"/>
<div class="flex-grow">
<p class="font-bold text-zinc-900">Anonymous</p>
<p class="text-sm text-zinc-500">Post an incident to the community</p>
</div>
<a href="./post.html"><button class="btn-primary">Post</button></a>
</div>
</div>
<div class="px-4 pb-2">
<h2 class="text-lg font-bold text-zinc-900">Recent Reports</h2>
</div>
</header>
<main id="reports-container" class="divide-y pb-16">
<div id="loading-state" class="p-4 text-center">
<p class="text-zinc-500">Loading reports...</p>
</div>
</main>
<footer class="footer">
<nav class="flex justify-around items-center h-16">
<a class="nav-item active" href="./index.html">
<span class="material-symbols-outlined">home</span>
<span class="text-xs font-bold">Home</span>
</a>
<a class="nav-item" href="./report.html">
<span class="material-symbols-outlined">description</span>
<span class="text-xs font-medium">Report</span>
</a>
<a class="nav-item" href="./post.html">
<span class="material-symbols-outlined">photo_camera</span>
<span class="text-xs font-medium">Camera</span>
</a>
<a class="nav-item" href="./profile.html">
<span class="material-symbols-outlined">person</span>
<span class="text-xs font-medium">Profile</span>
</a>
</nav>
</footer>
</div>

<script type="module">
// Load and display reports from Firebase
document.addEventListener('DOMContentLoaded', async function() {
  const reportsContainer = document.getElementById('reports-container');
  const loadingState = document.getElementById('loading-state');
  
  try {
    // Wait for Firebase to initialize
    await new Promise(resolve => {
      const checkReady = () => {
        if (window.reportManager) {
          resolve();
        } else {
          setTimeout(checkReady, 100);
        }
      };
      checkReady();
    });

    // Get reports from Firebase
    const reports = await window.reportManager.getAllReports();
    
    // Clear loading state
    loadingState.style.display = 'none';
    
    if (reports.length === 0) {
      reportsContainer.innerHTML = '<div class="p-4 text-center"><p class="text-zinc-500">No reports found. <a href="./post.html" class="text-primary">Create your first report</a></p></div>';
      return;
    }
    
    // Display reports
    reports.forEach(report => {
      const article = document.createElement('article');
      article.className = 'article';
      
      const statusColor = report.status === 'Solved' ? 'text-green-500' : 
                         report.status === 'Pending' ? 'text-yellow-500' : 
                         'text-blue-500';
      
      const createdDate = report.createdAt ? new Date(report.createdAt.toDate()).toLocaleDateString() : 'Unknown date';
      
      article.innerHTML = `
        <div class="p-4">
          <div class="relative">
            ${report.imageUrl ? 
              `<img alt="Report image" class="w-full h-auto rounded-lg" src="${report.imageUrl}"/>` :
              `<div class="w-full h-40 bg-gray-300 rounded-lg flex items-center justify-center">
                <span class="material-symbols-outlined text-gray-500 text-4xl">image</span>
              </div>`
            }
            <button class="absolute top-2 right-2 px-4 py-2 text-sm font-semibold text-zinc-900 bg-white rounded-full backdrop-blur-sm">Report</button>
          </div>
          <div class="pt-4">
            <h3 class="text-lg font-bold text-zinc-900">${report.title || 'Untitled Report'}</h3>
            <p class="mt-1 text-zinc-600">${report.description || 'No description provided'} <button class="text-primary font-semibold">read more</button></p>
            <p class="text-sm text-zinc-500 mt-1">${report.location || 'Location not specified'}</p>
            <p class="text-xs ${statusColor} mt-1">Status: ${report.status || 'Reported'} â€¢ ${createdDate}</p>
          </div>
        </div>
        <div class="flex justify-around py-2">
          <button class="flex items-center gap-2 px-3 py-2 text-zinc-600 hover-primary rounded-full">
            <span class="material-symbols-outlined">thumb_up</span>
            <span class="text-sm font-semibold">${report.likes || 0}</span>
          </button>
          <button class="flex items-center gap-2 px-3 py-2 text-zinc-600 hover-primary rounded-full">
            <span class="material-symbols-outlined">bookmark</span>
            <span class="text-sm font-semibold">${report.bookmarks || 0}</span>
          </button>
          <button class="flex items-center gap-2 px-3 py-2 text-zinc-600 hover-primary rounded-full">
            <span class="material-symbols-outlined">share</span>
            <span class="text-sm font-semibold">${report.shares || 0}</span>
          </button>
        </div>
      `;
      
      reportsContainer.appendChild(article);
    });
    
  } catch (error) {
    console.error('Error loading reports:', error);
    loadingState.innerHTML = '<p class="text-red-500">Error loading reports. Please try again later.</p>';
  }
});
</script>
</body>
</html>